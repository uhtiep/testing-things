<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Undertale-style Survival Game</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    canvas {
      display: block;
      background-color: #000;
      margin: 0 auto;
    }
    #score {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: white;
    }
  </style>
</head>
<body>

  <canvas id="gameCanvas"></canvas>
  <div id="score">Score: 0</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const WIDTH = window.innerWidth;
    const HEIGHT = window.innerHeight;
    canvas.width = WIDTH;
    canvas.height = HEIGHT;

    // Player setup
    const player = {
      x: WIDTH / 2,
      y: HEIGHT / 2,
      width: 40,
      height: 40,
      speed: 5,
      color: "cyan",
      health: 3
    };

    // Game variables
    let score = 0;
    let gameOver = false;

    // Enemies setup
    const enemies = [];

    // Event listeners for player movement
    const keys = { left: false, right: false, up: false, down: false };

    document.addEventListener("keydown", (e) => {
      if (e.code === "ArrowLeft" || e.code === "KeyA") keys.left = true;
      if (e.code === "ArrowRight" || e.code === "KeyD") keys.right = true;
      if (e.code === "ArrowUp" || e.code === "KeyW") keys.up = true;
      if (e.code === "ArrowDown" || e.code === "KeyS") keys.down = true;
    });

    document.addEventListener("keyup", (e) => {
      if (e.code === "ArrowLeft" || e.code === "KeyA") keys.left = false;
      if (e.code === "ArrowRight" || e.code === "KeyD") keys.right = false;
      if (e.code === "ArrowUp" || e.code === "KeyW") keys.up = false;
      if (e.code === "ArrowDown" || e.code === "KeyS") keys.down = false;
    });

    // Player movement
    function movePlayer() {
      if (keys.left && player.x > 0) player.x -= player.speed;
      if (keys.right && player.x < WIDTH - player.width) player.x += player.speed;
      if (keys.up && player.y > 0) player.y -= player.speed;
      if (keys.down && player.y < HEIGHT - player.height) player.y += player.speed;
    }

    // Create enemies periodically
    function createEnemies() {
      if (Math.random() < 0.02 && !gameOver) {  // Lower spawn frequency
        const enemy = {
          x: Math.random() * WIDTH,
          y: Math.random() * HEIGHT,
          width: 40,
          height: 40,
          color: "red",
          speed: 3
        };
        enemies.push(enemy);
      }
    }

    // Update and render enemies
    function updateEnemies() {
      for (let i = 0; i < enemies.length; i++) {
        const enemy = enemies[i];
        const angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);
        enemy.x += Math.cos(angle) * enemy.speed;
        enemy.y += Math.sin(angle) * enemy.speed;

        // Draw enemy
        ctx.fillStyle = enemy.color;
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);

        // Check collision with player
        if (isCollision(player, enemy)) {
          player.health -= 1;
          enemies.splice(i, 1);  // Remove enemy upon collision
          score++;  // Increase score when an enemy hits player
        }
      }
    }

    // Collision check
    function isCollision(a, b) {
      return a.x < b.x + b.width &&
             a.x + a.width > b.x &&
             a.y < b.y + b.height &&
             a.y + a.height > b.y;
    }

    // Game logic and rendering
    function update() {
      if (gameOver) return;

      movePlayer();
      createEnemies();
      updateEnemies();

      ctx.clearRect(0, 0, WIDTH, HEIGHT);

      // Draw player
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);

      // Draw score and health
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 20, 30);
      ctx.fillText("Health: " + player.health, 20, 60);

      // Handle game over
      if (player.health <= 0) {
        gameOver = true;
        ctx.fillText("GAME OVER", WIDTH / 2 - 70, HEIGHT / 2);
      }

      requestAnimationFrame(update);
    }

    // Start the game
    update();

  </script>

</body>
</html>
